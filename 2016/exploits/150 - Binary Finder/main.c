#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>
#include <string.h>
#include <limits.h>
#include <unistd.h>
#include <fcntl.h>
#include <sys/stat.h>

#define  BUFFER_SIZE 512

void callMe()
{
	int    fd;
	char   buffer[512];
	size_t size;

	fd   = open(".flag", O_RDONLY);
	size = read(fd, buffer, sizeof(buffer) - 1);
	buffer[size] = 0;

	printf("Congratulations! Flag is %s\n", buffer);
	exit(EXIT_SUCCESS);
}

void showUsage(char *arg)
{
	printf("Usage: %s <binary>\n", arg);
	printf("Finds where a binary is.\n");
}

void find(char *path, char *binary)
{
	char buffer[PATH_MAX + NAME_MAX];
	size_t i, j;

	j = 0;
	for(i = 0; path[i] != 0; i++) {
		if(path[i] != ':') {
			buffer[j] = path[i];
			j++;
		} else {
			buffer[j]     = '/';
			buffer[j + 1] = 0;
			strncat(buffer, binary, NAME_MAX);

			if(access(buffer, F_OK) == 0)
				printf("%s\n", buffer);

			j = 0;
		}
	}

	buffer[j]     = '/';
	buffer[j + 1] = 0;
	strncat(buffer, binary, NAME_MAX);

	if(access(buffer, F_OK) == 0)
		printf("%s\n", buffer);
}

int main(int argc, char* argv[])
{
	char *env = getenv("PATH");

	if(argc != 2 || env == NULL) {
		showUsage(argv[0]);
		return EXIT_FAILURE;
	}

	find(env, argv[1]);
	return EXIT_SUCCESS;
}
