CC=gcc
FLAGS=-m32 -fno-stack-protector -z execstack -ansi -pedantic -Wall -Werror -Wextra
USER=xer
GROUP=xer

all: release
	

debug:
	$(CC) $(FLAGS) exploit.c -ggdb -DDEBUG=1 -o exploit

exploit: exploit.c
	$(CC) $(FLAGS) exploit.c -o exploit

release: flag exploit
	chown ${USER}:${GROUP} exploit.c
	chown ${USER}:${GROUP} exploit
	chown ${USER}:${GROUP} flag
	chmod u=rx,g=rx,o=rx   exploit.c
	chmod u=srx,g=rx,o=rx  exploit
	chmod u=r,g=,o=        flag
	make freeze

freeze: exploit.c exploit flag
	chattr +i Makefile
	chattr +i exploit.c
	chattr +i exploit
	chattr +i flag

unfreeze: exploit.c exploit flag
	chattr -i Makefile
	chattr -i exploit.c
	chattr -i exploit
	chattr -i flag

clean: unfreeze
	rm exploit
